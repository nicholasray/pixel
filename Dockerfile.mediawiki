FROM docker-registry.wikimedia.org/dev/buster-php72-fpm:2.0.0-s1

RUN curl -fsSL https://deb.nodesource.com/setup_16.x | bash - \
	&& apt-get install -y nodejs

COPY src /src
COPY repositories.json /repositories.json

WORKDIR /var/www/html/w

RUN git config --global user.email "app@example.com" && git config --global user.name "app"

RUN /src/setupRepos.js "$( cat /repositories.json )"
